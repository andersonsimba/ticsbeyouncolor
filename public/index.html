<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test de Daltonismo</title>

    <link rel="stylesheet" href="styles.css">

    <!-- Librerías para PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to right, #d6ecff, #ffe8f3);
            margin: 0;
            padding: 0;
        }
        .hidden { display: none; }
        .container {
            width: 90%;
            max-width: 700px;
            margin: 40px auto;
            background: white;
            padding: 30px;
            border-radius: 14px;
            box-shadow: 0 0 20px rgba(0,0,0,0.12);
        }
        button {
            padding: 12px 25px;
            border: none;
            cursor: pointer;
            border-radius: 8px;
            color: white;
            background: #4a89ff;
            margin: 4px;
            font-size: 15px;
        }
        button.green { background: #3da450; }
        button.red { background: #d64545; }
        input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #ccc;
        }
        .progress {
            width: 100%;
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin: 10px 0;
        }
        .progress-bar {
            width: 0%;
            height: 100%;
            background: #4caf50;
            border-radius: 5px;
            transition: width .3s;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table td, table th {
            border: 1px solid #ddd;
            padding: 8px;
        }
        canvas {
            width: 100%;
            height: 300px;
            background: #fff;
            border-radius: 10px;
            margin-top: 15px;
        }
    </style>
</head>

<body>

<!-- ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ -->
<!--   PANTALLA INICIO -->
<!-- ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ -->

<div id="start-screen" class="container">
    <h2>Test de Daltonismo (Ishihara)</h2>

    <label><b>Ingresa tu nombre:</b></label>
    <input id="username-input" type="text" placeholder="Escribe tu nombre">

    <button id="start-btn" class="green">Iniciar Test</button>

    <hr>
    <button id="admin-open-btn">Acceso Administrador</button>
</div>


<!-- ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ -->
<!--   PANTALLA TEST -->
<!-- ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ -->

<div id="test-screen" class="container hidden">
    <h2>Test en Progreso</h2>

    <div class="progress"><div id="progress-bar" class="progress-bar"></div></div>
    <p id="progress-text">0% completado</p>

    <img id="test-image" src="" width="100%" style="border-radius:10px;">

    <label>¿Qué número ves?</label>
    <input id="user-answer" type="number" placeholder="Tu respuesta">

    <button id="next-btn" class="green">Siguiente</button>
</div>


<!-- ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ -->
<!--  PANTALLA FINAL  -->
<!-- ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ -->

<div id="end-screen" class="container hidden">
    <h2>Resultados</h2>

    <p id="final-score"></p>
    <p id="final-message"></p>

    <button id="save-btn" class="green">Guardar Resultado</button>
    <button id="view-stats-btn">Ver Panel de Control</button>
    <button id="export-pdf-result">Exportar PDF</button>
</div>


<!-- ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ -->
<!--    ESTADÍSTICAS -->
<!-- ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ -->

<div id="stats-screen" class="container hidden">
    <h2>Panel de Estadísticas</h2>

    <p id="stats-info-name"></p>
    <p id="stats-info-latest"></p>
    <p id="stats-info-total"></p>

    <table id="history-table">
        <thead>
        <tr>
            <th>Nombre</th>
            <th>Puntuación</th>
            <th>%</th>
            <th>Tiempo</th>
            <th>Fecha</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>

    <canvas id="line-chart" width="600" height="300"></canvas>

    <button id="export-pdf-stats">Exportar PDF</button>
    <button id="clear-storage" class="red">Borrar Datos</button>
    <button id="back-home-btn">Volver al Inicio</button>
</div>


<!-- ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ -->
<!--  ADMIN LOGIN (solo login) -->
<!-- ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ -->

<div id="admin-screen" class="container hidden">
    <h2>Acceso Administrador</h2>

    <label>Introduce contraseña:</label>
    <input id="admin-pass" type="password">

    <button id="admin-login-btn" class="green">Entrar</button>
    <button id="admin-cancel-btn" class="red">Cancelar</button>

    <hr>
</div>


<!-- ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ -->
<!--  PANEL ADMIN REAL (SEPARADO) -->
<!-- ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ -->

<div id="admin-panel" class="container hidden">
    <h3>Panel Admin</h3>
    <p>Acceso total a los datos guardados.</p>

    <button id="admin-export-csv">Exportar CSV</button>
    <button id="admin-logout" class="red">Cerrar sesión admin</button>
</div>

<script src="script.js"></script>
</body>
</html>
